{% extends 'base.html' %}

{% block nav %}
  {% include 'includes/nav.html' %}
{% endblock %}
{% block body_class %}bg-ranking{% endblock %}

{% block body %}
<main class="ranking-content ranking-page">
  <div class="container align-items-center py-4 d-flex justify-content-center align-content-start min-vw-100">

    <div class="row g-3 align-items-start px-5 main-row-rk-panel">

      <!-- LEFT: creator + selected preview -->
      <aside class="col-12 col-lg-3">
        <div class="rk-panel rk-panel--blue mb-3">
          <div class="rk-panel__head">
            <div>
              <div class="rk-title">Creador de ranking</div>
              <div class="rk-subtitle">Elige categoría y arma tu Top 5</div>
            </div>
          </div>

          <div class="rk-panel__body">
            <label class="rk-label">Categoría</label>

            <select id="categorySelect"
                    class="form-select rk-select"
                    data-api-base="{{ ranking_pool_api_url }}">
              {% for c in categories %}
                <option value="{{ c.code }}">{{ c.name }}</option>
              {% endfor %}
            </select>

            <button id="resetBtn" class="btn rk-btn-reset w-100 mt-3">
              <i class="bx bx-refresh"></i> Reset ranking
            </button>

            <div class="rk-stats mt-3">
              <span>Seleccionados</span>
              <span><strong id="filledCount">0</strong>/5</span>
            </div>
          </div>
        </div>

        <div class="rk-panel rk-panel--purple">
          <div class="rk-panel__head">
            <div>
              <div class="rk-title">Top seleccionado</div>
              <div class="rk-subtitle">Vista rápida de lo que llevas</div>
            </div>
          </div>
          <div class="rk-panel__body">
            <div id="selectedList" class="rk-selected"></div>
          </div>
        </div>
      </aside>

      <!-- CENTER: big Top5 card with slots -->
      <section class="col-12 col-lg-6">
        <div class="rk-hero">
          <div class="rk-hero__head">
            <div>
              <div class="rk-hero__title">TOP 5 RANKING</div>
              <div class="rk-hero__subtitle">Arrastra desde la derecha · Reordena soltando en otra posición</div>
            </div>
            <div class="rk-badge">Drag & Drop</div>
          </div>

          <div class="rk-hero__body">
            <div id="top5List" class="rk-top5"></div>
          </div>

          <div class="p-3 align-items-center justify-content-center d-flex gap-3 flex-column">
            <button id="saveRankingBtn" class="btn rk-btn-reset w-25 btn-save" type="button">
              <i class="bx bxs-trophy"></i> Guardar ranking
            </button>
            <small id="saveMsg" class="text-white-50 d-block"></small>
          </div>
        </div>
      </section>

      <!-- RIGHT: search + pool -->
      <aside class="col-12 col-lg-3 max-hv-80">
        <div class="rk-panel rk-panel--cyan mb-3">
          <div class="rk-panel__head">
            <div>
              <div class="rk-title">Listado</div>
              <div class="rk-subtitle">Busca y arrastra al Top 5</div>
            </div>
            <div class="rk-mini">
              <span>Items</span>
              <strong id="poolCount">0</strong>
            </div>
          </div>

          <div class="rk-panel__body">
            <div class="rk-search">
              <i class="bx bx-search"></i>
              <input id="searchInput" class="rk-search__input" type="text" placeholder="Buscar…">
              <button id="clearSearchBtn" class="rk-search__clear" type="button">Limpiar</button>
            </div>
          </div>
        </div>

        <div class="rk-pool-wrap">
          <div id="poolGrid" class="rk-pool"></div>
        </div>

        <small class="text-white-50 d-block mt-2">
          Tip: arrastra desde el Top 5 hacia el listado para quitar.
        </small>
      </aside>

    </div>
  </div>
</main>

<script src="/static/js/ranking.js"></script>
{% endblock body %}
