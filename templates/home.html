
{% extends 'base.html' %}

{% load text_filters %}
{% block nav %}
  {% include 'includes/nav.html' %}
{% endblock %}

{% block body_class %}bg-home{% endblock %}

{% block body %}
<main class="home-content">
  <div class="container-fluid min-vh-100 px-5">

    <div class="games-header pt-4 mb-4">
      <div class="games-header__inner">
        <div class="games-header__title">
          <i class="bx bxs-joystick"></i>
          <h2 class="m-0">All Games</h2>
        </div>
        <div class="games-header__sub">Browse the catalogue ¬∑ Click a card to view details</div>
      </div>
    </div>

    <div class="row g-4 align-items-start home-layout">

      <!-- MAIN GRID -->
      <section class="col-12 col-lg-9">
        <section class="games-grid">
          {% for g in page_obj %}
          <article class="game-card js-tilt js-game-open">
            <div class="game-card__inner">
              <div class="game-card__front">
                <div class="game-cover js-tilt-cover">
                  {% if g.cover_url %}
                    <img src="{{ g.cover_url }}" alt="{{ g.name }}">
                  {% else %}
                    <div class="cover-fallback">{{ g.name }}</div>
                  {% endif %}
                </div>

                <div class="game-body js-tilt-body">
                  <h3 class="game-title js-tilt-title" title="{{ g.name }}">{{ g.name }}</h3>

                  <div class="game-meta js-tilt-meta">
                    {% if g.platforms %}
                      {% for p in g.platforms|split:"|" %}
                        <span class="meta-pill">{{ p }}</span>
                      {% endfor %}
                    {% else %}
                      <span class="meta-pill">Unknown platform</span>
                    {% endif %}
                  </div>
                </div>
              </div>

              <div class="game-card__back" aria-hidden="true"></div>
      
            <section class="game-hidden" hidden>
              <span data-field="id">{{ g.id }}</span>
              <span data-field="slug">{{ g.slug|default:'' }}</span>
              <span data-field="release">{{ g.first_release_date|default:"" }}</span>
              <span data-field="developers">{{ g.developers|default:'' }}</span>
              <span data-field="publishers">{{ g.publishers|default:'' }}</span>
              <span data-field="rating">{{ g.total_rating|stringformat:"s"|default:"" }}</span>
              <span data-field="rating_count">{{ g.total_rating_count|stringformat:"s"|default:"" }}</span>
              <span data-field="cover">{{ g.cover_url|default:'' }}</span>
              <span data-field="platforms">{{ g.platforms|default:'' }}</span>
              <span data-field="genres">{{ g.genres|default:'' }}</span>
              <span data-field="name">{{ g.name|default:'' }}</span>
            </section>
          </article>
          {% endfor %}
        </section>


    <!-- PAGINATION (igual que lo tienes) -->
      <nav class="pagination-wrap" aria-label="Games pagination">
      <ul class="pagination pagination-gamer justify-content-center">

        {% if page_obj.has_previous %}
        <li class="page-item">
            <a class="page-link page-link-back" href="?page={{ page_obj.previous_page_number }}">¬´</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link page-link-back">¬´</span>
        </li>
        {% endif %}
        {# ventana de p√°ginas: 3 alrededor #}
        {% for num in page_obj.paginator.page_range %}
          {% if num >= page_obj.number|add:"-3" and num <= page_obj.number|add:"3" %}
            {% if page_obj.number == num %}
              <li class="page-item active"><span class="page-link">{{ num }}</span></li>
            {% else %}
              <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
            {% endif %}
          {% endif %}
        {% endfor %}

       {% if page_obj.has_next %}
        <li class="page-item">
            <a class="page-link page-link-forward" href="?page={{ page_obj.next_page_number }}">¬ª</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link page-link-forward">¬ª</span>
        </li>
        {% endif %}
        </ul>
        <p class="text-center games-sub m-0">
        Page {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
      </p>
    </nav>
  </section>
  <!-- SIDEBAR (mock visual, sin l√≥gica) -->
      <aside class="col-12 col-lg-3 right-panel">
        <div class="home-sidebar">

          <!-- √öltima review (mock usando el primer item de la p√°gina, sin backend) -->
          <div class="home-panel mb-3">
            <div class="home-panel__head">
              <div>
                <div class="home-panel__title">√öltima review</div>
                <div class="home-panel__sub">Vista r√°pida (mock)</div>
              </div>
              <i class="bx bxs-star"></i>
            </div>

            <div class="home-panel__body">
              {% for g in page_obj %}
                {% if forloop.first %}
                  <div class="side-card">
                    <div class="side-cover">
                      {% if g.cover_url %}
                        <img src="{{ g.cover_url }}" alt="{{ g.name }}">
                      {% else %}
                        <div class="cover-fallback">No cover</div>
                      {% endif %}
                    </div>

                    <div class="side-info">
                      <div class="side-title" title="{{ g.name }}">{{ g.name }}</div>
                      <div class="side-sub">
                        Rating: <strong>{{ g.total_rating|stringformat:"s"|default:"‚Äî" }}</strong>
                        <span class="side-dot">‚Ä¢</span>
                        Votes: <strong>{{ g.total_rating_count|stringformat:"s"|default:"‚Äî" }}</strong>
                      </div>
                      <div class="side-mini">
                        <span class="chip">Review #1</span>
                        <span class="chip chip-alt">Mock</span>
                      </div>
                    </div>
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          </div>

          <!-- √öltimos comentarios (mock) -->
          <div class="home-panel mb-3">
            <div class="home-panel__head">
              <div>
                <div class="home-panel__title">√öltimos comentarios</div>
                <div class="home-panel__sub">Solo visual por ahora</div>
              </div>
              <i class="bx bxs-message-rounded-dots"></i>
            </div>

            <div class="home-panel__body">
              <div class="comment-row">
                <div class="comment-avatar">GT</div>
                <div class="comment-text">
                  <strong>@user1</strong>
                  <div class="comment-snippet">‚ÄúEste juego me sorprendi√≥‚Ä¶‚Äù</div>
                </div>
              </div>

              <div class="comment-row">
                <div class="comment-avatar">AB</div>
                <div class="comment-text">
                  <strong>@user2</strong>
                  <div class="comment-snippet">‚ÄúTop recomendado para 2000s.‚Äù</div>
                </div>
              </div>

              <div class="comment-row">
                <div class="comment-avatar">MK</div>
                <div class="comment-text">
                  <strong>@user3</strong>
                  <div class="comment-snippet">‚ÄúLa portada y el dise√±o est√°n üî•‚Äù</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Ranking / Top (mock) -->
          <div class="home-panel">
            <div class="home-panel__head">
              <div>
                <div class="home-panel__title">Ranking destacado</div>
                <div class="home-panel__sub">Solo para ver c√≥mo queda</div>
              </div>
              <i class="bx bxs-trophy"></i>
            </div>

            <div class="home-panel__body">
              <div class="rank-row"><span class="rank-pill">#1</span> <span>Game A</span></div>
              <div class="rank-row"><span class="rank-pill">#2</span> <span>Game B</span></div>
              <div class="rank-row"><span class="rank-pill">#3</span> <span>Game C</span></div>
              <div class="rank-row"><span class="rank-pill">#4</span> <span>Game D</span></div>
              <div class="rank-row"><span class="rank-pill">#5</span> <span>Game E</span></div>
            </div>
          </div>

        </div>
      </aside>

    </div>
  </div>
</main>

<!-- MODAL (a√±adido, no rompe nada) -->
<div class="game-modal" id="gameModal" aria-hidden="true">
  <div class="game-modal__backdrop" data-close></div>

  <div class="game-modal__panel" role="dialog" aria-modal="true" aria-label="Game details">
    <button class="modal-close" type="button" aria-label="Close" data-close>X</button>
    <div class="game-modal__content">
      <div class="game-modal__cover">
        <img id="modalCover" alt="">
        <div id="modalCoverFallback" class="cover-fallback" style="display:none;">No cover</div>
      </div>

      <div class="game-modal__info">
        <h2 id="modalTitle" class="game-modal__title"></h2>

        <div class="game-modal__facts">
          <div class="game-modal__fact"><span>ID:</span> <strong id="modalIgdbId"></strong></div>
          <div class="game-modal__fact"><span>Release:</span> <strong id="modalRelease"></strong></div>
          <div class="game-modal__fact"><span>Rating:</span> <strong id="modalRating"></strong></div>
          <div class="game-modal__fact"><span>Votes:</span> <strong id="modalRatingCount"></strong></div>
          <div class="game-modal__fact"><span>Developers:</span> <strong id="modalDevelopers"></strong></div>
          <div class="game-modal__fact"><span>Publishers:</span> <strong id="modalPublishers"></strong></div>
        </div>

        <div class="game-modal__section">
          <h4>Platforms</h4>
          <div id="modalPlatforms" class="game-modal__pills "></div>
        </div>

        <div class="game-modal__section">
          <h4>Genres</h4>
          <div id="modalGenres" class="game-modal__pills"></div>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="/static/js/home-card-game.js"></script>
{% endblock %}
