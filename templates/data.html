{% extends 'base.html' %}
{% load static %}
{% load text_filters %}
{% block nav %}
  {% include 'includes/nav.html' %}
{% endblock %}

{% block title %}Boss Panel{% endblock %}


{% block body_class %}bg-boss{% endblock %}


{% block body %}
<main class="boss-content">
    <div class="container px-5 min-vh-100 min-vw-100 d-flex align-items-center justify-content-center">

 <section class="boss-wrapper">

      <div class="boss-cards">

        <!-- CARD 1: DATA LOAD (EXPANDE) -->
        <article class="boss-card is-collapsed" id="bossCardData">
          <div class="boss-card__inner js-expander" role="button" tabindex="0" aria-expanded="false">
            <img src="{% static 'img/add_file.png' %}" alt="" class="boss-card__icon">
            <h3 class="boss-card__title">Data Load</h3>
            <p class="boss-card__sub">Load or update DB</p>
          </div>

          <div class="boss-card__expander" aria-hidden="true">
            <button type="button" class="boss-card__close js-collapser" aria-label="Cerrar">×</button>

            <div class="boss-card__expanderBody">
              <p class="boss-card__desc">
                Upload datasets / CSV / JSON to load or update DB.
              </p>
           <form id="dataLoadForm"
                action="{% url 'load_data_movies' %}"
                method="post"
                enctype="multipart/form-data">
            {% csrf_token %}

            <input id="updateFileInput"
                    type="file"
                    name="update_file"
                    accept=".csv"
                    class="file-hidden"
                    required>

                <div class="boss-file-row">
                    <label for="updateFileInput" class="boss-btn boss-btn--primary" id="btnPickFile">
                    Import CSV
                    </label>

                    <span class="boss-file-path" id="fileNamePreview">
                    Not File selected
                    </span>

                    <button type="submit"
                            class="boss-btn boss-btn--secondary boss-file-submit"
                            id="btnSubmitCsv"
                            action="{% url 'load_data_movies' %}"
                            disabled>
                    Accept File
                    </button>
                </div>
            </form>

            </div>
          </div>
        </article>

        <!-- CARD 2: COLLECTIONS (ABRE MODAL) -->
        <article class="boss-card is-collapsed" id="bossCardCollections">
          <div class="boss-card__inner js-open-collections" role="button" tabindex="0">
            <img src="{% static 'img/add_categories.png' %}" alt="" class="boss-card__icon">
            <h3 class="boss-card__title">Add Categories</h3>
            <p class="boss-card__sub">Create and Admin Collections</p>
          </div>

          <!-- (Opcional) también con expander si quieres info extra -->
          <div class="boss-card__expander" aria-hidden="true">
            <button type="button" class="boss-card__close js-collapser" aria-label="Cerrar">×</button>

            <div class="boss-card__expanderBody">
              <p class="boss-card__desc">
                Create custom Categories (Top RPG, Indies, Soulslike…) by Ranking Games.
              </p>

            <button type="button" class="boss-btn boss-btn--secondary js-open-collections">
                Open Collections Form
            </button>
            </div>
          </div>
        </article>

      </div>
    </section>
    </div>
</main>

<!-- MODAL Categories -->
<div class="boss-modal" id="collectionsModal" aria-hidden="true">
  <div class="boss-modal__backdrop" data-close></div>

  <div class="boss-modal__panel" role="dialog" aria-modal="true">
    <button class="boss-modal__close" type="button" data-close aria-label="Cerrar">×</button>

    <h3 class="boss-modal__title">Create Category</h3>
    <p class="boss-modal__sub">Define rules for a ranking category</p>

    <form class="boss-form" id="categoryForm" method="post" action="{% url 'create_news_categories' %}">
      {% csrf_token %}

      <input type="hidden" name="platforms_any_json" id="platformsJson" value="[]">
      <input type="hidden" name="genres_any_json" id="genresJson" value="[]">
      <input type="hidden" name="decades_any_json" id="decadesJson" value="[]">

      <!-- BODY SCROLLEABLE (solo contenido) -->
      <div class="boss-modal__body">

        <!-- BASIC INFO -->
        <div class="boss-section">
          <div class="boss-section__head">
            <span class="boss-section__title">Basic</span>
            <small class="boss-help">Name + description</small>
          </div>

          <div class="boss-grid-2">
            <label class="boss-label span-2">
              Name
              <input class="boss-input boss-input--light" type="text" name="name" required placeholder="Top JRPG 90s">
            </label>

            <label class="boss-label span-2">
              Description
              <textarea class="boss-textarea boss-input--light" name="description" rows="3" required
                placeholder="Best JRPG released during the 1990s"></textarea>
            </label>
          </div>
        </div>

        <!-- DECADES (ARRIBA) -->
        <div class="boss-section">
          <div class="boss-section__head">
            <span class="boss-section__title">Decades</span>
            <small class="boss-help">Click to select/deselect. Selecting a decade sets the year range.</small>
          </div>

          <div class="boss-chips" id="decadeChips">
            {% for d in decade_options %}
              <button type="button" class="boss-chip" data-group="decades" data-value="{{ d }}">
                <span>{{ d }}s</span><span class="boss-chip__x">+</span>
              </button>
            {% endfor %}
          </div>
        </div>

        <!-- YEARS-->
        <div class="boss-section">
          <div class="boss-section__head">
            <span class="boss-section__title">Years</span>
            <small class="boss-help">Manual range (auto-updated by decade)</small>
          </div>

          <div class="boss-years">
            <div class="boss-years__col">
              <label class="boss-label boss-label--small">From year</label>
              <select class="boss-input boss-input--light" name="year_from" id="yearFromSelect">
                <option value="">Any</option>
                {% for y in year_options %}
                  <option value="{{ y }}">{{ y }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="boss-years__col">
              <label class="boss-label boss-label--small">To year</label>
              <select class="boss-input boss-input--light" name="year_to" id="yearToSelect">
                <option value="">Any</option>
                {% for y in year_options %}
                  <option value="{{ y }}">{{ y }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>

        <!-- PLATFORM BRANDS -->
        <div class="boss-section">
          <div class="boss-section__head">
            <span class="boss-section__title">Platform brands</span>
            <small class="boss-help">Filter the platform list so it stays manageable.</small>
          </div>

          <div class="boss-chips boss-chips--brands" id="platformBrandChips">
            <button type="button" class="boss-chip is-selected" data-brand="all"><span>All</span><span class="boss-chip__x">×</span></button>
            <button type="button" class="boss-chip" data-brand="nintendo"><span>Nintendo</span><span class="boss-chip__x">+</span></button>
            <button type="button" class="boss-chip" data-brand="sony"><span>Sony</span><span class="boss-chip__x">+</span></button>
            <button type="button" class="boss-chip" data-brand="microsoft"><span>Microsoft</span><span class="boss-chip__x">+</span></button>
            <button type="button" class="boss-chip" data-brand="sega"><span>Sega</span><span class="boss-chip__x">+</span></button>
            <button type="button" class="boss-chip" data-brand="pc"><span>PC</span><span class="boss-chip__x">+</span></button>
            <button type="button" class="boss-chip" data-brand="other"><span>Other</span><span class="boss-chip__x">+</span></button>
          </div>
        </div>

        <!-- PLATFORMS -->
        <div class="boss-section">
          <div class="boss-section__head">
            <span class="boss-section__title">Platforms</span>
            <small class="boss-help">Click to select/deselect.</small>
          </div>

          <div class="boss-chips boss-chips--platforms" id="platformChips">
            {% for p in platform_options %}
              <button type="button" class="boss-chip" data-group="platforms" data-value="{{ p|escape }}">
                <span>{{ p }}</span><span class="boss-chip__x">+</span>
              </button>
            {% endfor %}
          </div>
        </div>

        <!-- GENRES -->
        <div class="boss-section">
          <div class="boss-section__head">
            <span class="boss-section__title">Genres</span>
            <small class="boss-help">Click to select/deselect.</small>
          </div>

          <div class="boss-chips boss-chips--genres" id="genreChips">
            {% for g in genre_options %}
              <button type="button" class="boss-chip" data-group="genres" data-value="{{ g|escape }}">
                <span>{{ g }}</span><span class="boss-chip__x">+</span>
              </button>
            {% endfor %}
          </div>
        </div>

        <!-- RULES -->
        <div class="boss-section">
          <div class="boss-section__head">
            <span class="boss-section__title">Rules</span>
            <small class="boss-help">Limits</small>
          </div>

          <div class="boss-grid-2">
            <label class="boss-label">
              Minimum votes
              <input class="boss-input boss-input--light" type="number" name="min_votes" min="0" value="0">
            </label>

            <label class="boss-label">
              Pool size (max games shown)
              <input class="boss-input boss-input--light" type="number" name="pool_limit" min="20" max="500" value="200">
            </label>
          </div>

          <input type="hidden" name="sort_by" value="popular">
        </div>

      </div>

      <!-- FOOTER FIXED (no se monta, siempre visible) -->
      <div class="boss-modal__footer boss-form__actions">
        <button type="button" class="boss-btn boss-btn--ghost" data-close>Cancel</button>
        <button type="submit" class="boss-btn boss-btn--primary">Save Category</button>
      </div>
    </form>
  </div>
</div>


<script src="/static/js/data-cards.js"></script>

{% endblock %}